<ion-view ng-controller="MapCtrl" title="{{navTitle}}" left-buttons="leftButtons" right-buttons="rightButtons" hide-back-button="true" class="bubble-background title-style">

  <ion-content data-tap-disabled="true">
    <div class="view-filter filter-button">
      <i class="icon ion-gear-a custom-icon" ng-click="openModal(1)"></i>
    </div>
    <div ng-click="findCenter()">
      <div id="locate-before-start" ng-class="{'showBlocker': !foundLocation, 'hideBlocker': foundLocation}">
          tap to find location
      </div>
    </div>

    <leaflet lf-center="center" center="center" paths="paths" markers="markers" event-broadcast="events" defaults="defaults" id='map' custom-controls="myCustomControls" geojson="geojson"></leaflet>
  </ion-content>
    <ion-footer-bar id="footer-bar">
      <div class="nav-div">
        <button ng-click="findCenter()" class="button">
          <svg width="31px" height="32px" viewBox="0 0 31 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" class="button-fill">
            <title>map-icon</title>
            <desc>Created with Sketch.</desc>
            <defs></defs>
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                  <g id="Bike-Racks-Icon" sketch:type="MSArtboardGroup" transform="translate(-103.000000, -577.000000)">
                      <g id="Group-3" sketch:type="MSLayerGroup" transform="translate(103.000000, 577.000000)">
                          <path d="M28.0946656,5.07619608 L23.1995245,5.07619608 C22.1232878,2.40674837 19.4847721,0.5 16.4296485,0.5 C13.374525,0.5 10.7360092,2.40674837 9.65977253,5.07619608 L2.71630997,5.07619608 C1.43176939,5.07619608 0.390250007,6.11624064 0.390250007,7.39896227 L0.390250007,29.5865796 C0.390250007,30.8693012 1.43176939,31.9093458 2.71630997,31.9093458 L28.0946656,31.9093458 C29.3792062,31.9093458 30.4207256,30.8693012 30.4207256,29.5865796 L30.4207256,7.39896227 C30.4207256,6.11624064 29.3792062,5.07619608 28.0946656,5.07619608 L28.0946656,5.07619608 Z M16.4296485,5.14553238 C17.818341,5.14553238 18.9292951,6.25491325 18.9292951,7.64163933 C18.9292951,7.78031194 18.9292951,7.8843164 18.8945777,8.022989 L18.8945777,8.022989 L18.8945777,8.022989 C18.7904258,8.61234759 18.5126873,9.13236987 18.0960795,9.51371954 L18.0613622,9.5483877 C18.0266449,9.58305585 17.9919276,9.617724 17.9572103,9.65239215 C17.922493,9.65239215 17.922493,9.6870603 17.8877757,9.6870603 C17.8530584,9.72172846 17.818341,9.72172846 17.7836237,9.75639661 C17.7489064,9.75639661 17.7141891,9.79106476 17.7141891,9.79106476 C17.6794718,9.82573291 17.6447545,9.82573291 17.6100372,9.86040106 C17.5753199,9.86040106 17.5406025,9.89506922 17.5058852,9.89506922 C17.4711679,9.89506922 17.4364506,9.92973737 17.4017333,9.92973737 C17.367016,9.92973737 17.3322987,9.96440552 17.2975814,9.96440552 C17.262864,9.96440552 17.2281467,9.99907367 17.1934294,9.99907367 C17.1587121,9.99907367 17.1239948,10.0337418 17.0545602,10.0337418 C17.0198429,10.0337418 16.9851255,10.0337418 16.9504082,10.06841 C16.9156909,10.06841 16.8462563,10.06841 16.811539,10.1030781 L16.7421043,10.1030781 L16.4990832,10.1030781 L16.256062,10.1030781 L16.1866273,10.1030781 C16.15191,10.1030781 16.0824754,10.1030781 16.0477581,10.06841 C16.0130408,10.06841 15.9783235,10.06841 15.9436062,10.0337418 C15.9088888,10.0337418 15.8394542,9.99907367 15.8047369,9.99907367 C15.7700196,9.99907367 15.7353023,9.96440552 15.700585,9.96440552 C15.6658677,9.96440552 15.6311503,9.92973737 15.596433,9.92973737 C15.5617157,9.92973737 15.5269984,9.89506922 15.4922811,9.89506922 C15.4575638,9.89506922 15.4228465,9.86040106 15.3881291,9.86040106 C15.3534118,9.82573291 15.3186945,9.82573291 15.2839772,9.79106476 C15.2492599,9.79106476 15.2145426,9.75639661 15.2145426,9.75639661 C15.1798253,9.72172846 15.145108,9.72172846 15.1103906,9.6870603 C15.0756733,9.6870603 15.0756733,9.65239215 15.040956,9.65239215 C15.0062387,9.617724 14.9715214,9.58305585 14.9368041,9.5483877 L14.9020868,9.51371954 C14.485479,9.13236987 14.1730232,8.61234759 14.1035886,8.022989 L14.1035886,8.022989 L14.1035886,8.022989 C14.0688713,7.8843164 14.0688713,7.78031194 14.0688713,7.64163933 C13.930002,6.25491325 15.040956,5.14553238 16.4296485,5.14553238 L16.4296485,5.14553238 Z M3.09820041,28.9625529 L3.09820041,14.1939201 L12.819048,28.9625529 L3.09820041,28.9625529 L3.09820041,28.9625529 Z M27.7127752,28.9625529 L14.6937829,28.9625529 L13.2356558,26.7437911 L27.6780579,18.7007798 L27.7127752,28.9625529 L27.7127752,28.9625529 L27.7127752,28.9625529 Z M27.7127752,16.7940315 L12.4024402,25.4264014 L3.06348309,11.1084545 L3.06348309,8.022989 L9.13901284,8.022989 C9.38203403,12.113831 16.4296485,19.9835015 16.4296485,19.9835015 C16.4296485,19.9835015 23.477263,12.1484991 23.7202842,8.022989 L27.7127752,8.022989 L27.7127752,16.7940315 L27.7127752,16.7940315 Z" id="map-icon" sketch:type="MSShapeGroup"></path>
                      </g>
                  </g>
              </g>
          </svg>
        </button>
      </div>

      <div class="nav-div">
        <button ng-click="openModal(2)" class="button">
          <img class="title-image bottom-tab-nav-img" src="img/bike-assets/bike-icon.svg" />
        </button>
      </div>

      <div class="nav-div">
        <button ng-click="openModal(4)" class="button">
          <img class="title-image bottom-tab-nav-img" src="img/bike-assets/landmark-icon.svg" />
        </button>
      </div>

      <div class="nav-div">
        <button ng-click="openModal(6)" class="button">
          <img class="title-image bottom-tab-nav-img" src="img/bike-assets/bikerack-icon-temp.png" />
        </button>
      </div>
    </ion-footer-bar>

<!-- filter modals -->

  <script id="filter-modal.html" type="text/ng-template">
    <div class="modal filter-modal">
      <ion-header-bar>
        <h1 class="title">Filters</h1>
      </ion-header-bar>
      <ion-content>
        <div class="list">
            <div class="pinViews item">
              <a class="item item-icon-left" ng-click="openModal(7); closeModal(1)" ng-class="{'btn2': showPointsOnDrag, 'btn1': !showPointsOnDrag}">
              <i class="icon"><img class="title-image bottom-tab-nav-img" src="img/bike-assets/pin-yellow.png" /></i>
                &nbsp;&nbsp;&nbsp; My Favorites
              </a>
              <br />

              <a class="item item-icon-left" ng-click="setShowPointsOnDrag()" ng-class="{'btn2': showPointsOnDrag, 'btn1': !showPointsOnDrag}">
              <i class="icon"><img class="title-image bottom-tab-nav-img" src="img/bike-assets/pin-yellow.png" /></i>
                &nbsp;&nbsp;&nbsp; Show Points on Drag
              </a>
              <br />

              <a class="item item-icon-left" ng-click="setShowStations()" ng-class="{'btn2': showStations, 'btn1': !showStations}">
              <i class="icon" ng-class="testcolor"><img class="title-image filter-but-img" src="img/bike-assets/bike-icon.svg" /> </i>
                &nbsp;&nbsp;&nbsp; Bike Share Stations
              </a>

              <a class="item item-icon-left" ng-click="setShowLandmarks()" ng-class="{'btn2': showLandmarks, 'btn1': !showLandmarks}">
              <i class="icon"><img class="title-image filter-but-img" src="img/bike-assets/landmark-icon.svg" /></i>
                &nbsp;&nbsp;&nbsp; Landmarks
              </a>

              <a class="item item-icon-left" ng-click="setShowBikeRacks()" ng-class="{'btn2': showBikeRacks, 'btn1': !showBikeRacks}">
              <i class="icon"><img class="title-image bottom-tab-nav-img" src="img/bike-assets/bikerack-icon-temp.png" /></i>
                &nbsp;&nbsp;&nbsp; Public Bike Racks
              </a>
              <br />
              <div id="radiusDiv" class="button-bar">
                <button class="button buttonStyle" ng-click="setRadius(805)" ng-class="{'btn2': radiusHalf, 'btn1': !radiusHalf}">
                    <img class="title-image radius-button-img" src="img/bike-assets/small-radius.svg" />
                </button>
                <button class="button buttonStyle" ng-click="setRadius(1610)" ng-class="{'btn2': radiusMile, 'btn1': !radiusMile}">
                  <img class="title-image radius-button-img" src="img/bike-assets/medium-radius.svg" />
                </button>
                <button class="button buttonStyle" ng-click="setRadius(3220)" ng-class="{'btn2': radiusTwoMile, 'btn1': !radiusTwoMile}">
                  <img class="title-image radius-button-img" src="img/bike-assets/large-radius.svg" />
                </button>
                <button class="button buttonStyle" ng-click="setRadius(50000)" ng-class="{'btn2': radiusAll, 'btn1': !radiusAll}">All</button>
              </div>
            <div class="done">
              <button class="button buttonStyle button-full button-energized done" ng-click="setPinsWithinRadius(); closeModal(1)">Done</button>
            </div>
          </div>
        </div>
      </ion-content>
    </div>
  </script>

  <script id="bikeShareList.html" type="text/ng-template">
    <div class="modal">
      <ion-header-bar class="bar bar-header">
        <h1 class="title" >{{stationCount}} Bike Share near you</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(2)"></button>
      </ion-header-bar>
        <ion-content>
          <ion-list show-delete="false" can-swipe="true" class="itemInList"><span id="swipeWords">Swipe left for directions</span>
            <ion-item ng-repeat="item in bikesharePoints" class="eachItem">
              <img class="bshLogo" ng-src="https://pbs.twimg.com/profile_images/620747721574514688/IAjDd0oc.jpg">
              <div class="padding">
                <i id="swipeRight" class="icon ion-chevron-left"></i>
                <h2>{{ item.name }}</h2>
                <h4 class="icon ion-ios-location-outline">&nbsp;&nbsp;{{ item.distanceToFrom }} miles</h4>
                <ion-option-button class="button icon ion-navigate" ng-click="getDirections({{ item.lat }}, {{ item.long }})"></ion-option-button>
                <ion-option-button class="button icon ion-information-circled" ng-click="changeCurrentMarker(item); checkFavorite(currentMarkerProperties); openModal(3);  closeModal(2);"></ion-option-button>
              </div>
            </ion-item>
          </ion-list>
        </ion-content>
    </div>
  </script>

  <script id="landmarkList.html" type="text/ng-template">
    <div class="modal">
      <ion-header-bar class="bar bar-header">
        <h1 class="title" >{{stationCount}} Landmarks near you</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(4)"></button>
      </ion-header-bar>
        <ion-content>
          <ion-list show-delete="false" can-swipe="true" class="itemInList"><span id="swipeWords">Swipe left for directions</span>
            <ion-item ng-repeat="item in landmarkPoints" class="eachItem">
              <img class="bshLogo" ng-src="{{ item.photolink }}">
              <div class="padding">
                <i id="swipeRight" class="icon ion-chevron-left"></i>
                <h2>{{ item.name }}</h2>
                <h4 class="icon ion-ios-location-outline">&nbsp;&nbsp;{{ item.distanceToFrom }} miles</h4>
                <ion-option-button class="button icon ion-navigate" ng-click="getDirections({{ item.lat }}, {{ item.long }})"></ion-option-button>
                <ion-option-button class="button icon ion-information-circled" ng-click="changeCurrentMarker(item); checkFavorite(currentMarkerProperties); openModal(3);  closeModal(4);"></ion-option-button>
              </div>
            </ion-item>
          </ion-list>
        </ion-content>
    </div>
  </script>

  <script id="bikeRackList.html" type="text/ng-template">
    <div class="modal">
      <ion-header-bar class="bar bar-header">
        <h1 class="title" >{{stationCount}} Bike Racks near you</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(6)"></button>
      </ion-header-bar>
        <ion-content>
          <ion-list show-delete="false" can-swipe="true">
            <ion-item ng-repeat="item in bikeRackPoints" class="eachItem">
              <div class="padding">
                <i id="swipeRight" class="icon ion-chevron-right"></i>
                <h2>{{ item.description }}</h2>
                <h4>{{ item.distanceToFrom }} miles</h4>
                <ion-option-button class="button icon ion-navigate" ng-click="getDirections({{ item.lat }}, {{ item.long }}); closeModal(6)"></ion-option-button>
                <ion-option-button class="button icon ion-information-circled" ng-click="changeCurrentMarker(item); checkFavorite(currentMarkerProperties); openModal(3);  closeModal(6);"></ion-option-button>
              </div>
            </ion-item>
          </ion-list>
        </ion-content>
    </div>
  </script>

  <script id="favorites.html" type="text/ng-template">
    <div class="modal">
      <ion-header-bar class="bar bar-header">
        <h1 class="title" >Favorites</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(7)"></button>
      </ion-header-bar>
        <ion-content>
          <ion-list show-delete="false" can-swipe="true">
            <ion-item ng-repeat="item in favoritesList track by $index" class="eachItem">
              <div class="padding">
                <i id="swipeRight" class="icon ion-chevron-left"></i>
                <h>{{ item.name }}</h1>
                <p>{{ item.description }}</p>
                <ion-option-button class="button icon ion-navigate" ng-click="getDirections({{ item.lat }}, {{ item.long }}); closeModal(7)"></ion-option-button>
                <ion-option-button class="button icon ion-information-circled" ng-click="changeCurrentMarker(item); checkFavorite(currentMarkerProperties); openModal(3);  closeModal(7);"></ion-option-button>
              </div>
            </ion-item>
          </ion-list>
        </ion-content>
    </div>
  </script>

   <script id="markerDetail.html" type="text/ng-template">
    <div class="modal" ng-model="currentMarkerProperties">
      <ion-header-bar class="bar bar-header">
        <h1 class="title">Location Details</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(3)"></button>
      </ion-header-bar>
        <ion-content>
            <ion-item>
              <div><p ng-if="currentMarkerProperties.photolink"> <img class="detailsPhoto"ng-src="{{currentMarkerProperties.photolink}}" /> </p></div>
            </ion-item>
            <div class="locationDetails">
              <p ng-if="currentMarkerProperties.site_id">Site ID: {{currentMarkerProperties.site_id}} on <span ng-if="currentMarkerProperties.photolink">{{currentMarkerProperties.info}}</span></p>
              <p ng-if="currentMarkerProperties.description">{{currentMarkerProperties.description}}</p>
              <p ng-if="currentMarkerProperties.geolink"><a target="_blank" href="{{currentMarkerProperties.geolink}}">Street View</a></p>
              <!-- <p><a target="_blank" href="{{currentMarkerProperties.sitelink}}">Site</a></p> -->
            </div>
            <ion-item>
              <i ng-click="addFavorite(); checkFavorite();" ng-class="{'button button-icon icon locationMenu fa fa-star-o fa-fw':!isFavorited, 'button button-icon icon locationMenu fa fa-star fa-fw':isFavorited}"></i>
                <h2>Add to Favorites</h2>
            </ion-item>
            <ion-item>
              <i ng-click="addSafetyWarn(); checkSafetyWarn();" ng-class="{'button button-icon icon locationMenu fa fa-circle-o fa-fw':!isSafetyWarn, 'button button-icon icon locationMenu fa fa-exclamation-circle fa-fw':isSafetyWarn}"></i>
                <h2>Add Safety Incident</h2>
                <p class="floatingDetail">&nbsp;&nbsp;&nbsp;{{currentMarkerProperties.safetyCounter || 0}} Incident(s)</p>
            </ion-item>
            <ion-item ng-click="openModal(5)">
                <i class="button button-icon icon locationMenu fa fa-pencil-square-o fa-fw"></i>
                <h2 class="floatingDetail">Report/Suggest</h2>
             </ion-item>
        </ion-content>
    </div>
  </script>

  <script id="reportDetail.html" type="text/ng-template">
    <div class="modal">
      <ion-header-bar class="bar bar-header">
        <h1 class="title">Report/Suggest</h1>
        <button class="button icon ion-arrow-down-b" ng-click="closeModal(5)"></button>
      </ion-header-bar>
      <ion-content>
        <ion-item>
          <div class="list">
            <label class="item item-input item-select">
              <div class="input-label">
                I'd like to make a:
              </div>
              <select ng-model="comment.type">
                <option>Report</option>
                <option selected>Suggestion</option>
              </select>
            </label>
          </div>
          <div class="list">
            <label class="item item-input item-select">
              <div class="input-label">
                Subject:
              </div>
              <select ng-model="comment.subject">
                <option ng-if="comment.type === 'Report'">Found</option>
                <option ng-if="comment.type === 'Report'" selected>Missing</option>
                <option ng-if="comment.type === 'Report'">Dangerous</option>
                <option ng-if="comment.type === 'Report'">Theft</option>
                <option ng-if="comment.type === 'Report'">Correction</option>
                <option ng-if="comment.type === 'Report'">Other</option>
                <option ng-if="comment.type === 'Suggestion'">Rack</option>
                <option ng-if="comment.type === 'Suggestion'">BikeShare</option>
                <option ng-if="comment.type === 'Suggestion'">OldHawaii</option>
                <option ng-if="comment.type === 'Suggestion'">General</option>
              </select>
            </label>
          </div>
          <div class="list">
            <label class="item item-input">
              <textarea ng-model='comment.description' required name="comment" id="comment" cols="30" rows="10"></textarea>
            </label>
          </div>
          <div>
            <label class="item item-input">
              <input  placeholder="Name" type="text" ng-model='comment.name' >
            </label>
          </div>
          <div>
            <label class="item item-input">
              <input  placeholder="Email" type="email" ng-model='comment.email' >
            </label>
          </div>
          <div class="list">
            <label class="item item-input item-select">
              <div class="input-label">
                Can we contact you about this?
              </div>
              <select ng-model="comment.contact">
                <option>Yes</option>
                <option selected>No</option>
              </select>
            </label>
          </div>
          <ion-item ng-click="postComment(comment)">
            <h2 class="floatingDetail">Submit {{comment.type}}</h2>
          </ion-item>
        </ion-item>
      </ion-content>
    </div>
  </script>
</ion-view>
